<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASTRO-7 Ship Schematics</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        body {
            margin: 0;
            background: #0a1a4d;
            color: #00ffff;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        model-viewer {
            width: 100vw;
            height: 100vh;
            background-color: #0a1a4d;
            --progress-bar-color: #00ffff;
            --progress-bar-height: 2px;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2em;
            text-shadow: 0 0 10px #00ffff;
            z-index: 1;
        }

        .progress-bar {
            display: block;
            width: 33%;
            height: 10%;
            max-height: 2px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate3d(-50%, -50%, 0);
            border-radius: 25px;
            box-shadow: 0px 3px 10px 3px rgba(0, 255, 255, 0.5);
            background-color: rgba(0, 255, 255, 0.7);
        }

        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
            display: flex;
            gap: 10px;
        }

        .controls button {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 8px 16px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
        }

        .controls button:hover {
            background: rgba(0, 255, 255, 0.4);
        }

        .hotspots {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(10, 26, 77, 0.8);
            padding: 10px;
            border: 1px solid #00ffff;
            display: none;
        }

        @media (max-width: 768px) {
            model-viewer {
                --camera-orbit-sensitivity: 0.7;
                --zoom-sensitivity: 0.5;
            }
            
            .controls {
                bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">Loading ASTRO-7 Schematics...</div>
    
    <model-viewer
        src="/models/harbinger.glb"
        camera-controls
        auto-rotate
        rotation-per-second="30deg"
        camera-orbit="45deg 55deg 3m"
        min-camera-orbit="auto auto 2m"
        max-camera-orbit="auto auto 10m"
        orbit-sensitivity="0.8"
        zoom-sensitivity="0.5"
        field-of-view="30deg"
        exposure="1.5"
        shadow-intensity="1"
        shadow-softness="1"
        environment-image="neutral"
        skybox-image="none"
        loading="eager"
        interaction-prompt="none"
        ar-status="not-presenting"
        touch-action="pan-y"
        interpolation-decay="200"
        camera-target="0m 0m 0m"
        draco-decoder-path="https://www.gstatic.com/draco/v1/decoders/"
        aria-label="Interactive 3D model of ASTRO-7 spaceship">
        
        <div class="progress-bar" slot="progress-bar"></div>
        
        <!-- Add annotations/hotspots if needed -->
        <button slot="hotspot-1" data-position="1m 0m 0m" data-normal="1 0 0">
            Engine Bay
        </button>
    </model-viewer>

    <div class="controls">
        <button id="autoRotateToggle">Toggle Rotation</button>
        <button id="resetCamera">Reset View</button>
    </div>

    <script>
        // Check WebGL support
        if (!window.WebGLRenderingContext) {
            document.body.innerHTML = '<div style="color: #00ffff; text-align: center; padding: 20px;">Your browser does not support WebGL, which is required to view these schematics.</div>';
            throw new Error('WebGL not supported');
        }

        const modelViewer = document.querySelector('model-viewer');
        const loadingElement = document.getElementById('loading');
        const autoRotateToggle = document.getElementById('autoRotateToggle');
        const resetCamera = document.getElementById('resetCamera');

        // Loading handler
        modelViewer.addEventListener('load', () => {
            loadingElement.style.display = 'none';
            
            // Optional: Add initial camera animation
            modelViewer.cameraOrbit = `${45}deg ${55}deg 3m`;
            modelViewer.updateFraming();
        });

        // Error handler
        modelViewer.addEventListener('error', (error) => {
            console.error('Error loading model:', error);
            loadingElement.textContent = 'Error loading schematics. Please refresh.';
            loadingElement.style.color = '#ff0000';
        });

        // Controls handlers
        autoRotateToggle.addEventListener('click', () => {
            modelViewer.autoRotate = !modelViewer.autoRotate;
        });

        resetCamera.addEventListener('click', () => {
            modelViewer.cameraOrbit = "45deg 55deg 3m";
            modelViewer.fieldOfView = "30deg";
        });

        // Optional: Add progress tracking
        modelViewer.addEventListener('progress', (event) => {
            const progress = event.detail.totalProgress * 100;
            loadingElement.textContent = `Loading: ${Math.round(progress)}%`;
        });

        // Handle visibility changes for better performance
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                modelViewer.autoRotate = false;
            }
        });

        // Optimize for mobile
        if (window.innerWidth < 768) {
            modelViewer.fieldOfView = "40deg"; // Wider view for mobile
            modelViewer.interpolationDecay = 150; // Smoother transitions
        }
    </script>
</body>
</html>